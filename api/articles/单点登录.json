{"title":"单点登录","uid":"99d3803d2ba14375937b06e7a1f36b52","slug":"单点登录","date":"2022-12-06T15:30:00.000Z","updated":"2022-12-07T08:39:07.971Z","comments":true,"path":"api/articles/单点登录.json","keywords":null,"cover":"https://cdn.staticaly.com/gh/yyg2403/picgocdn@master/blogimg/%E5%87%8C%E5%8D%8E_1920x1080.png","content":"<h1 id=\"单点登录\"><a href=\"#单点登录\" class=\"headerlink\" title=\"单点登录\"></a>单点登录</h1><p><img src=\"%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95/sso.png\"></p>\n<p>SSO ：Single Sign On，即：单点登录</p>\n<p>单点登录表现为：在集群或分布式系统中，客户端在其中的某1个服务器登录，后续的请求被分配到其它服务器处理时，其它服务器也能识别用户的身份。</p>\n<p>单点登录的实现方案有：</p>\n<p><img src=\"https://cdn.staticaly.com/gh/yyg2403/picgocdn@master/blogimg/sso1.png\" alt=\"sso1\"></p>\n<ul>\n<li>共享Session<ul>\n<li>把所有客户端的Session数据存储到专门的服务器上，其它任何服务器需要识别客户端身份时，都从这个专门的服务器上去查找、读取Session数据</li>\n<li>缺点：Session的有效期不宜过长</li>\n<li>优点：编码简单，读取Session数据基本上没有额外牺牲性能</li>\n</ul>\n</li>\n<li>Token<ul>\n<li>当某客户端登录成功，服务器端将响应Token到客户端，在后续的访问中，客户端自行携带Token数据来访问任何服务器，且任何服务器都具备解析此Token的功能，即可识别客户端的身份</li>\n<li>JWT（JSON Web Token）也是Token的一种</li>\n<li>缺点：编写代码略难，需要频繁解析JWT，需要牺牲一部分性能来进行解析</li>\n<li>优点：可以长时间有效</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"如何实现SSO\"><a href=\"#如何实现SSO\" class=\"headerlink\" title=\"如何实现SSO\"></a>如何实现SSO</h2><p>目前，在<code>csmall-passport</code>项目中已经现实了认证与授权，只要客户端能携带有效的JWT，则服务器端可以识别客户端的身份！</p>\n<p>在<code>csmall-product</code>项目中，只需要添加Spring Security框架的依赖项，并添加认证相关代码，就可以实现“客户端在<code>csmall-passport</code>登录后，在<code>csmall-product</code>上也可以识别用户的身份”！</p>\n<p>需要从<code>csmall-passport</code>中复制到<code>csmall-product</code>中的代码有：</p>\n<ul>\n<li><p>复制相关依赖项</p>\n<ul>\n<li><code>spring-boot-starter-security</code></li>\n<li><code>jjwt</code></li>\n<li><code>fastjson</code></li>\n</ul>\n</li>\n<li><p>复制<code>application-dev.yml</code>中关于JWT的自定义配置</p>\n</li>\n<li><p><code>LoginPrincipal</code></p>\n</li>\n<li><p><code>ServiceCode</code>（更新文件，在<code>passport</code>中添加了一些新的业务状态码，在<code>product</code>中也将需要使用到）</p>\n</li>\n<li><p><code>JwtAuthorizationFilter</code></p>\n</li>\n<li><pre><code>SecurityConfiguration\n</code></pre>\n<ul>\n<li>删除<code>PasswordEncoder</code>的<code>@Bean</code>方法</li>\n<li>删除<code>AuthenticationManager</code>的<code>@Bean</code>方法</li>\n<li>删除<code>configurer()</code>方法中“白名单”中的 <code>&quot;/admins/login&quot;</code> 路径</li>\n</ul>\n</li>\n<li><p><code>GlobalExceptionHandler</code>（更新文件，处理“无操作权限”相关异常）</p>\n</li>\n</ul>\n<p>在前端项目中，保证除了登录的每个请求都添加了请求头中的JWT即可。</p>\n<p>本项目基于Spring Security和JWT实现了SSO（单点登录）。</p>\n<h2 id=\"流程总结：\"><a href=\"#流程总结：\" class=\"headerlink\" title=\"流程总结：\"></a>流程总结：</h2><ol>\n<li>用户在登录页面中提交表单信息，把包含username和password的信息提交给服务器。</li>\n<li>服务器实现UserDetailsService接口 -&gt; 在UserDetailsServiceImpl中重写loadByUsername()方法，将username作为参数，并查询数据库中的<code>username</code>信息，并自动比对密码。第一次登录会生成JWT信息返回给客户端，下一次再访问的时候，需要将JWT信息配置在请求头中作为登录凭证。</li>\n<li>服务器后台过滤器接收到请求，我们判断他是否包含了符合要求的JWT信息，获取他请求头中<code>Authorization</code>属性中的值。如果JWT无效我们直接放行；</li>\n<li>如果有效，我们添加JWT信息解析，然后将解析得到的数据，自定义当前登录当事人<code>LoginPrincipal</code>，其中包含userId、username。</li>\n<li>通过实例化UsernamePasswordAuthenticationToken(userId,null,LoginPrincipal)，得到了创建<code>Authentication</code>认证信息。</li>\n<li>将创建的认证信息<code>Authentication</code>保存到<code>SecurityContext</code>中，然后放行。</li>\n<li>在<code>SecurityConfiguration</code>配置中自定义JWT过滤器，将我们自定义的过滤器添加在Spring Security框架内置的过滤器之前。</li>\n<li>控制器中通过注解参数<code>@AuthenticationPrincipal LoginPrincipal loginPrincipal</code> 进行当事人属性的传递。</li>\n<li>通过配置关闭预检功能。</li>\n</ol>\n","feature":"ture","text":"单点登录 SSO ：Single Sign On，即：单点登录 单点登录表现为：在集群或分布式系统中，客户端在其中的某1个服务器登录，后续的请求被分配到其它服务器处理时，其它服务器也能识别用户的身份。 单点登录的实现方案有： 共享Sessi...","link":"","photos":[],"count_time":{"symbolsCount":"1.8k","symbolsTime":"2 mins."},"categories":[],"tags":[{"name":"必会技能","slug":"必会技能","count":1,"path":"api/tags/必会技能.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E5%8D%95%E7%82%B9%E7%99%BB%E5%BD%95\"><span class=\"toc-text\">单点登录</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0SSO\"><span class=\"toc-text\">如何实现SSO</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%B5%81%E7%A8%8B%E6%80%BB%E7%BB%93%EF%BC%9A\"><span class=\"toc-text\">流程总结：</span></a></li></ol></li></ol>","author":{"name":"余有光","slug":"blog-author","avatar":"https://cdn.staticaly.com/gh/yyg2403/picgocdn@master/blogimg/qiqi.jpg","link":"/","description":"博主是个懒人，想起来更新博客就会写，取决于灵感来没来或者游戏肝完没有。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"prev_post":{"title":"常见面试题集锦","uid":"261a575d522f8fa1209360b03cf8aa7f","slug":"常见面试题集锦","date":"2022-12-07T15:44:12.000Z","updated":"2022-12-08T15:00:11.953Z","comments":true,"path":"api/articles/常见面试题集锦.json","keywords":null,"cover":"https://cdn.staticaly.com/gh/yyg2403/picgocdn@master/blogimg/yaoyaoqiqi.png","text":"常见面试题集锦一、自我介绍1、简单介绍自己的姓名、年龄、学历、籍贯等基本信息； 2、从事计算机行业时长，项目经历有哪些？ 3、重点介绍你最近的一个项目的情况 切忌把时间间隔比较就久的项目说的很具体，会浪费时间，导致你最想表达的近期项目没有时...","link":"","photos":[],"count_time":{"symbolsCount":"7.8k","symbolsTime":"7 mins."},"categories":[],"tags":[{"name":"面试","slug":"面试","count":2,"path":"api/tags/面试.json"}],"author":{"name":"余有光","slug":"blog-author","avatar":"https://cdn.staticaly.com/gh/yyg2403/picgocdn@master/blogimg/qiqi.jpg","link":"/","description":"博主是个懒人，想起来更新博客就会写，取决于灵感来没来或者游戏肝完没有。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":"ture"},"next_post":{"title":"常用软件下载与安装使用","uid":"82381b80c937780767578a231f4c2205","slug":"my-first-blog","date":"2022-12-04T04:59:50.000Z","updated":"2022-12-06T13:38:32.752Z","comments":true,"path":"api/articles/my-first-blog.json","keywords":null,"cover":[],"text":"一、Nacos1、Nacos 下载https://github.com/alibaba/nacos/releases/download/1.4.3/nacos-server-1.4.3.zip 2、安装启动Nacos 我们下载了Nacos软件 将压缩包解压(注意不要有中文路径或空...","link":"","photos":[],"count_time":{"symbolsCount":"2.1k","symbolsTime":"2 mins."},"categories":[],"tags":[{"name":"软件安装及使用","slug":"软件安装及使用","count":1,"path":"api/tags/软件安装及使用.json"}],"author":{"name":"余有光","slug":"blog-author","avatar":"https://cdn.staticaly.com/gh/yyg2403/picgocdn@master/blogimg/qiqi.jpg","link":"/","description":"博主是个懒人，想起来更新博客就会写，取决于灵感来没来或者游戏肝完没有。","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}